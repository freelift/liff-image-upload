<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ó</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }

    button {
      font-size: 18px;
      padding: 12px 24px;
      background-color: #00b900;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üì§ ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ó LINE</h2>
  <button id="openGalleryBtn">üì∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</button><br><br>
  <input type="file" id="imageInput" accept="image/*" style="display: none;" />
  <img id="preview" width="200" />

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    async function main() {
      await liff.init({ liffId: "2007890470-ryZVnqlX" }); // üëà ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

      const imageInput = document.getElementById('imageInput');
      const preview = document.getElementById('preview');
      const openGalleryBtn = document.getElementById('openGalleryBtn');

      openGalleryBtn.onclick = () => {
        imageInput.click();
      };

      imageInput.addEventListener('change', async function () {
        const file = imageInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async function (e) {
          const base64 = e.target.result;
          preview.src = base64;

          // üü° ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Ç‡∏∂‡πâ‡∏ô Imgur
          const imgurUrl = await uploadToImgur(base64);
          if (!imgurUrl) {
            alert("‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
            return;
          }

          // üü¢ ‡∏™‡πà‡∏á Flex Message ‡∏Å‡∏•‡∏±‡∏ö LINE
          const flexMessage = {
            type: "flex",
            altText: "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß",
            contents: {
              type: "bubble",
              hero: {
                type: "image",
                url: imgurUrl,
                size: "full",
                aspectRatio: "1:1",
                aspectMode: "cover"
              },
              body: {
                type: "box",
                layout: "vertical",
                contents: [
                  {
                    type: "text",
                    text: "üì§ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                    weight: "bold",
                    size: "md",
                    wrap: true
                  },
                  {
                    type: "text",
                    text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
                    size: "sm",
                    color: "#666666",
                    wrap: true,
                    margin: "md"
                  }
                ]
              }
            }
          };

          await liff.sendMessages([flexMessage]);
          alert("‚úÖ ‡∏™‡πà‡∏á Flex Message ‡πÅ‡∏•‡πâ‡∏ß");
          liff.closeWindow();
        };
        reader.readAsDataURL(file);
      });

      // ‚¨ÜÔ∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Ç‡∏∂‡πâ‡∏ô Imgur
      async function uploadToImgur(base64) {
        try {
          const response = await fetch("https://api.imgur.com/3/image", {
            method: "POST",
            headers: {
              Authorization: "Client-ID 6a219c28990b71a", // ‡πÉ‡∏ä‡πâ client id ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              image: base64.split(',')[1],
              type: "base64"
            })
          });
          const data = await response.json();
          return data.data.link;
        } catch (err) {
          console.error("Imgur upload failed:", err);
          return null;
        }
      }
    }

    main();
  </script>
</body>
</html>
